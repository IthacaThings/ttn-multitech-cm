---  

- name: Install Ansible dependency python-distutils
  opkg: 
    state: installed
    pkg: "python-distutils"
  when:
    - ansible_local is defined
    - ansible_local.opkg is defined
    - ansible_local.opkg.python_distutils is not defined

- name: Install Ansible dependency python-pkgutil
  opkg: 
    state: installed
    pkg: "python-pkgutil"
  when:
    - ansible_local is defined
    - ansible_local.opkg is defined
    - ansible_local.opkg.python_pkgutil is not defined

- name: /var/config/ansible
  file:
    name: /var/config/ansible
    state: directory
    mode: "0755"
    owner: root
    group: root

- name: /var/config/ansible/facts.d
  copy:
    dest: "/var/config/ansible/"
    mode: "0755"
    directory_mode: "0755"
    owner: root
    group: root
    src: facts.d
  register: ansible_facts_d

- name: Point /etc/ansible at /var/config/ansible
  file:
    name: /etc/ansible
    state: link
    src: /var/config/ansible
  register: var_config_ansible

- name: Reload ansible_local
  setup: filter=ansible_local
  when: ansible_facts_d|changed or var_config_ansible|changed
